# UI Prototype Product Spec

## 1. Objective
이 프로토타입의 목표는 사용자가 특정 영어 표현(단어/구문)의 의미를 사전식 번역 없이 맥락 기반으로 이해하고, 반복 복습을 통해 기억을 강화하도록 만드는 것이다.

핵심은 단순 입력 학습이 아니라, 망각-재노출-연상 회복 과정을 통해 의미를 기억에 고정시키는 경험을 제공하는 것이다.

## 2. Scope
### In Scope (이번 프로토타입)
- 표현 검색 입력(문장 입력 금지)
- 다의어 의미 선택
- 예문 1(텍스트 스토리)
- 예문 2(삽화 + 텍스트 스토리)
- 예문 3+(영상 + AI 생성 자막)
- 복습 진입(10초 카운트)
- 복습 스토리(2~4 페이지 분량)
- 복습 반복 루프(복습 더하기)
- 중단/저장/재개 플로우

### Out of Scope (이번 프로토타입 제외)
- 문장 단위 검색/해석 기능
- 정교한 개인화 추천
- 고급 사용자 계정/디바이스 동기화
- 최종 성능 최적화

## 3. UX Principles
1. 번역 매칭 대신 맥락 추론
2. 쉬운 단어 중심 스토리 구성
3. 동일 표현의 다중 맥락 노출
4. 의도적 망각 후 재노출
5. 사용자가 "아는 것"이 아니라 "떠올리는 것" 중심

## 4. User Flow (Storyboard)

### Page 1: Search
- 요소:
  - 텍스트 인풋 1개 (표현 입력)
  - 버튼 1개: `단어 검색`
- 규칙:
  - 문장 입력 금지(테스트 가능한 입력 규칙은 Tech Spec의 Search Input MUST 규칙을 따른다)
  - 단어/구문만 허용
- 예시: `take in`
- 전이:
  - 단일 의미 표현: `단어 검색` 클릭 -> `example_loading`(내부 로딩) -> Page 2
  - 다의어 표현: `단어 검색` 클릭 -> Meaning Select Page
- 단일 의미 자동 선택 규칙(MUST):
  - 단일 의미(`senses.length === 1`)면 `selectedSenseId = senses[0].senseId`를 검색 성공 직후 원자적으로 세션 상태에 저장한다.
  - 위 저장이 실패하거나 `selectedSenseId`가 비어 있으면 `example_loading`으로 전이하지 않고 하드 에러 처리한다.

### Meaning Select Page (for Multi-Sense Expressions)
- 노출 조건:
  - 검색 표현이 다의어(의미 후보 2개 이상)인 경우
- 요소:
  - 상단 타이틀: `어떤 의미를 학습할까요?`
  - 의미 후보 리스트(각 항목: 짧은 의미 설명 + 대표 예시 1문장)
  - 하단 버튼: `이 의미로 시작`
- 핵심 규칙:
  - 선택된 `sense`는 현재 학습 세션의 고정 컨텍스트가 된다.
  - 이후 예문/영상/복습 생성 파이프라인 전체에 동일 `selectedSenseId`를 전달한다.
- 전이:
  - 의미 선택 후 `selectedSenseId` 저장 성공 시 `example_loading`(내부 로딩) -> Page 2
  - 의미 저장 실패 시 `error`로 전이하고 재시도 또는 Search 복귀를 제공

### Page 2: Example 1 (Text Story)
- 요소:
  - 좌상단 라벨: `예문 1`
  - 중앙: AI 생성 텍스트 스토리(3~4문장)
  - 하단 버튼: `예문 더보기`
- 목적:
  - 검색 표현의 의미를 맥락으로 추론 가능하게 제공
- 전이:
  - `예문 더보기` -> Page 3

### Page 3: Example 2 (Illustration + Story)
- 요소:
  - 삽화 1개 (AI 생성)
  - 텍스트 스토리 3~4문장(예문 1과 다른 스토리)
  - 하단 버튼: `예문 더보기`
- 목적:
  - 시각 정보 + 맥락으로 의미 고정 강화
- 전이:
  - `예문 더보기` -> Page 4

### Page 4+: Example 3 and More (Video + Subtitle)
- 요소:
  - 영상 1개 (우선 기존 영상 검색 기반)
  - 하단 자막(영상 자막은 AI 생성)
  - 하단 버튼 1: `예문 더보기`
  - 하단 버튼 2: `복습하기`
- 동작:
  - `예문 더보기` 클릭 시 새 영상/자막으로 반복
  - 영상 검색 소진 시 fallback 전략 적용(후술)
  - 세션당 반복 상한 적용(`MAX_EXAMPLE_LOOPS_PER_SESSION`)
- 목적:
  - 실제 미디어 맥락에서 표현 사용 패턴 노출
- 전이:
  - `복습하기` -> 10초 카운트 페이지

### Review Countdown
- 요소:
  - 중앙 숫자 카운트다운: `10` -> `0`
- 규칙:
  - 카운트다운 고정값은 10초다.
- 목적:
  - 의도적 망각 구간 제공
- 전이:
  - 카운트 종료 -> Review Story Sequence

### Review Story Sequence (2~4 Pages)
- 요소(각 페이지):
  - 삽화(AI 생성)
  - 텍스트 스토리(AI 생성, 페이지당 3~4문장)
- 규칙:
  - 전체가 하나의 연결된 긴 스토리
  - 학습 표현은 초반에 바로 나오지 않을 수 있음
  - 중후반에 표현이 재등장하며 연상 회복 유도
- 목적:
  - 예문 1/2/3 경험과 재연결하여 기억 공고화
- 전이:
  - 마지막 페이지 도달 시 -> Final Review Page

### Final Review Page
- 요소:
  - 하단 버튼: `복습 더하기`
  - 보조 버튼: `여기까지 학습하기`
- 전이:
  - `복습 더하기` -> Review Countdown(10초) -> `generateReviewBatch` 재호출 -> 새 복습 스토리 반복
  - `여기까지 학습하기` -> Exit Confirm -> Pause Summary
- 루프 제한:
  - 세션당 반복 상한 `MAX_REVIEW_LOOPS_PER_SESSION` 적용
  - 상한 도달 시 `복습 더하기` 비활성화 + `여기까지 학습하기` CTA 강조

### Exit Confirm (Modal)
- 목적:
  - 사용자의 학습 중단 의도를 확인
- 선택지:
  - `계속 학습하기`
  - `중단하고 저장하기`
- 전이 규칙:
  - `계속 학습하기` -> Exit 호출 직전의 이전 상태로 즉시 복귀
  - `중단하고 저장하기` -> Pause Summary 전이 전 세션 저장 수행
- 카운트다운 연속성 규칙:
  - `review_countdown` 상태에서 Exit Confirm을 열면 남은 시간 값을 동결한다.
  - `계속 학습하기` 선택 시 동결된 남은 시간으로 카운트다운을 복원한다.
- 노출 범위:
  - 예문 단계, 영상 단계, 복습 카운트다운, 복습 스토리, 복습 마지막 페이지, 오류 화면

### Pause Summary Page
- 목적:
  - 중단 시점의 진행 상태를 요약하고 다음 재개를 준비
- 표시 정보:
  - 현재 학습 표현
  - 선택된 의미
  - 현재 위치(예문/복습 단계)
  - 마지막 진행 시각
- 버튼:
  - `메인으로 이동`
- 저장 게이트:
  - `중단하고 저장하기` 경로는 저장 성공이 확인된 경우에만 Pause Summary로 진입한다.
  - 저장 실패 시 오류 안내 + 재시도 CTA를 노출하며 Pause Summary 진입을 차단한다.

### Resume Prompt (on next app entry)
- 노출 조건:
  - 저장된 중단 세션이 있는 경우
- 선택지:
  - `이어하기` (기존 배치/인덱스 유지)
  - `처음부터 다시` (저장 세션 삭제 후 Search부터)
- 복귀 규칙:
  - `이어하기`는 저장된 `currentStage`와 `contentRef`를 기준으로 정확한 화면/인덱스로 복귀해야 한다.
  - `처음부터 다시`는 기존 PauseSession을 삭제하고 새 학습 세션으로 시작한다.

### Video Exhausted UX
- 노출 조건:
  - 외부 영상 소스 결과가 0건인 경우
- UX 규칙:
  - 자동 fallback 진행 상태를 표시한다.
  - 수동 재시도 CTA를 제공한다.
  - `복습하기` 우회 CTA를 제공한다.
  - Exit 요청 시 저장 가능 상태로 취급한다(세션 복원 가능해야 함).

### Error Recovery
- 노출 조건:
  - 생성 실패, 저장 실패, 의미 저장 실패 등으로 `error` 진입한 경우
- UX 규칙:
  - `다시 시도` CTA: 직전 재시도 가능 상태로 복귀
  - `메인으로 이동` CTA: Search로 복귀
  - 에러 코드와 요약 원인을 함께 표시

## 5. Content Policy

### Text Story Generation
- 입력: 검색 표현 + 선택 의미
- 출력: 쉬운 단어 중심, 맥락이 분명한 스토리
- 제약:
  - 표현 의미를 추측 가능하도록 충분히 풍부해야 함
  - 난이도 목표: CEFR A2~B1

### Illustration Generation
- 입력: 해당 페이지 스토리 컨텍스트
- 출력: 스토리 맥락을 시각적으로 보조하는 삽화

### Video Policy
- 단일 fallback 체인:
  - 1차: 기존 영상 검색 기반으로 표현 포함 구간 제공
  - 2차: 검색 소진 시 AI 생성 영상으로 대체
  - 3차: 생성 영상도 실패 시 에러 상태 + 재시도 CTA
- 본 프로토타입에서는 예문 3+ 구간을 영상 중심으로 유지한다(텍스트/삽화 대체 없음)

### Subtitle Policy
- 영상 자막은 AI가 생성
- 목적: 표현 의미와 문맥 파악 보조
- 실패 fallback:
  - 자막 생성 실패 시 `SUBTITLE_MAX_RETRIES` 기준 자동 재시도 수행
  - 자동 재시도 실패 시 기본 캡션(또는 무자막 재생) + 수동 재시도 CTA 제공
  - 텍스트 요약으로의 대체는 프로토타입 기본 정책에서 허용하지 않는다.

## 6. Learning Strategy Rules
1. 동일 표현의 다중 맥락 노출(텍스트/삽화/영상)
2. 복습 전 10초 망각 구간 제공
3. 복습 스토리에서 지연 노출 전략 사용
4. 반복 루프로 기억 재활성화 유도

## 7. MVP Success Criteria
- 사용자 1명이 검색부터 복습 반복까지 1회 이상 완주 가능
- 예문 1/2/3 + 복습 루프가 화면/버튼 흐름 상 끊김 없이 동작
- 검색 표현(선택 의미 기준)이 복습 스토리에서 재노출되는 구조가 재현됨
- 중단/재개(이어하기/처음부터) 흐름이 충돌 없이 동작

## 8. Open Questions
1. 영상 검색 소스 우선순위(유튜브/드라마 클립/내부 라이브러리)
2. AI 자막 정확도 임계치와 보정 정책
3. 문장 입력 금지 판정의 휴리스틱 정확도 향상 방식(룰 기반 vs 경량 분류기)
4. 비용/속도/품질 균형을 위한 생성 요청 제한 정책의 추가 튜닝 수치

## 9. Default Decisions (Prototype Lock)
- 복습 페이지 기본값은 `3`으로 고정한다(허용 범위 2~4).
- 카운트다운 재개는 남은 시간을 복원하는 것을 기본 정책으로 한다.
- 모든 생성 파이프라인은 동일 `selectedSenseId`를 필수 입력으로 사용한다.
- `MAX_EXAMPLE_LOOPS_PER_SESSION = 5`
- `MAX_REVIEW_LOOPS_PER_SESSION = 5`
- `MAX_GENERATION_RETRIES = 3`
- `SUBTITLE_MAX_RETRIES = 1`

## 10. Delivery Sequence (Planner view)
1. 검색-의미선택-예문1-예문2-예문3 기본 루프 구현
2. 복습 카운트다운 + 복습 스토리 루프 구현
3. 중단/저장/재개 구현
4. 영상/자막 정책 정교화
5. fallback 및 쿼터 정책 적용
