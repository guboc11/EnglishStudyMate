# TECH_RULES — 개발 워크플로우 규칙

> 프로젝트 비전·컨셉은 [CLAUDE.md](./CLAUDE.md) 참조

---

## 1. 기획 완성 기준 (Code Gate)

**다음이 모두 완성되기 전까지 코드를 한 줄도 작성하지 않는다.**

- [ ] 전체 폴더 구조도 (파일명·폴더명 확정)
- [ ] 각 파일의 export 목록
- [ ] 모든 함수 시그니처 (이름·파라미터명·타입·리턴타입)
- [ ] 파일 간 의존 관계 다이어그램
- [ ] 운영자 승인 완료

기획 문서 없이 "일단 만들어보기"는 금지.

---

## 2. 기획 문서 명세 수준

기획 문서는 다음 수준까지 작성한다:

```
# 기능명

## 폴더 구조
src/
└── features/
    └── persona/
        ├── PersonaEngine.ts     ← export: PersonaEngine class
        ├── knowledgeGraph.ts    ← export: KnowledgeGraph, NodeType
        └── types.ts             ← export: Persona, Message, Emotion

## 함수 시그니처 예시
PersonaEngine.respond(
  input: string,
  personaId: string,
  context: ConversationContext
): Promise<PersonaResponse>

## 의존 관계
PersonaEngine → KnowledgeGraph → types
```

시그니처 없는 기획 문서는 미완성으로 간주.

---

## 3. 코딩 원칙

| 원칙 | 설명 |
|------|------|
| **최소한의 코드** | 현재 요구사항만 구현. 미래 확장 대비 코드 금지 |
| **가독성 우선** | 영리한 코드보다 읽히는 코드 |
| **하나씩** | 한 번에 하나의 기능만 구현 |
| **기존 파일 편집 우선** | 새 파일 생성은 꼭 필요할 때만 |
| **헬퍼 추상화 금지** | 한 번 쓰는 로직을 위한 유틸 함수 만들지 말 것 |
| **오버 엔지니어링 금지** | 에러 핸들링·유효성 검사는 시스템 경계에서만 |

---

## 4. 병렬 처리 가이드

독립적인 컴포넌트/모듈은 에이전트를 분리해 동시 진행한다.

**병렬 가능 조건:**
- 두 작업이 서로의 출력에 의존하지 않음
- 각 작업이 명확히 분리된 파일에서 동작

**병렬 예시:**
```
[에이전트 A] PersonaEngine 구현
[에이전트 B] KnowledgeGraph 구현  ← 동시 진행 가능
```

**순차 필요 예시:**
```
[단계 1] types.ts 완성
[단계 2] PersonaEngine.ts (types 의존)  ← 단계 1 완료 후
```

병렬 작업 시작 전 의존 관계를 명시적으로 확인할 것.

---

## 5. 운영자-AI 협업 원칙

1. **단계마다 확인**: 각 단계 완료 후 운영자 검토 → 승인 → 다음 단계
2. **승인 없이 진행 금지**: 운영자가 읽고 이해할 시간을 확보
3. **속도 조절**: 빠르게 달리는 것보다 방향이 맞는 것이 중요
4. **질문 우선**: 불확실한 결정은 먼저 물어볼 것
5. **되돌리기 어려운 작업**: 확인 후 진행 (파일 삭제, git 이력 변경 등)

**단계별 체크포인트:**
```
기획 초안 → [운영자 검토] → 기획 확정 → [운영자 승인]
→ 코드 작성 → [운영자 검토] → 테스트 → [운영자 승인]
→ 다음 기능
```
